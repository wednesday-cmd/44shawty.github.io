/*
 * XenForo avatar.min.js
 * Copyright 2010-2017 XenForo Ltd.
 * Released under the XenForo License Agreement: https://xenforo.com/license-agreement
 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,e,c){a instanceof String&&(a=String(a));for(var f=a.length,d=0;d<f;d++){var b=a[d];if(e.call(c,b,d,a))return{i:d,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,c){a!=Array.prototype&&a!=Object.prototype&&(a[e]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,e,c,f){if(e){c=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var d=a[f];d in c||(c[d]={});c=c[d]}a=a[a.length-1];f=c[a];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
!function(a,e,c,f){XF.AvatarUpload=XF.Element.newHandler({options:{},init:function(){var d=this.$target,b=d.find(".js-uploadAvatar"),c=d.find(".js-avatar"),e=d.find(".js-deleteAvatar");c.find("img").length?e.show():e.hide();b.on("change",a.proxy(this,"changeFile"));d.on("ajax-submit:response",a.proxy(this,"ajaxResponse"))},changeFile:function(d){""!=a(d.target).val()&&this.$target.submit()},ajaxResponse:function(d,b){if(!b.errors&&!b.exception){d.preventDefault();b.message&&XF.flashMessage(b.message,
3E3);var c=this.$target;d=c.find(".js-deleteAvatar");var e=c.find(".js-uploadAvatar"),f=c.find(".js-avatar"),g=c.find(".js-avatarX"),h=c.find(".js-avatarY");if(c=1==c.find('input[name="use_custom"]:checked').val())f.css({left:-1*b.cropX,top:-1*b.cropX}),g.val(b.cropX),h.val(b.cropY),f.data("x",b.cropX),f.data("y",b.cropY),XF.Element.initializeElement(f),e.val("");else if(a(".js-gravatarPreview").attr("src",b.gravatarTest?b.gravatarPreview:b.gravatarUrl),b.gravatarTest)return;XF.updateAvatars(b.userId,
b.avatars,c);b.defaultAvatars?d.hide():d.show();a(".js-avatarCropper").trigger("avatar:updated",b)}}});XF.AvatarCropper=XF.Element.newHandler({options:{size:96,x:0,y:0},$img:null,size:96,x:0,y:0,imgW:null,imgH:null,cropSize:null,scale:null,init:function(){this.$target.one("avatar:updated",a.proxy(this,"avatarsUpdated"));this.$img=this.$target.find("img");this.$img.length&&this.initTest()},avatarsUpdated:function(a,b){this.options.x=b.cropX;this.options.y=b.cropY;this.init()},initTest:function(){var a=
this.$img[0],b=0,c=this,e=function(){b++;50<b||(0<a.naturalWidth?c.setup():0===a.naturalWidth&&setTimeout(e,100))};e()},setup:function(){this.imgW=this.$img[0].naturalWidth;this.imgH=this.$img[0].naturalHeight;this.cropSize=Math.min(this.imgW,this.imgH);this.scale=this.cropSize/this.options.size;this.$img.cropbox({width:this.size,height:this.size,zoom:0,maxZoom:0,controls:!1,showControls:"never",result:{cropX:this.options.x*this.scale,cropY:this.options.y*this.scale,cropW:this.cropSize,cropH:this.cropSize}}).on("cropbox",
a.proxy(this,"onCrop"))},onCrop:function(a,b){this.$target.parent().find(".js-avatarX").val(b.cropX/this.scale);this.$target.parent().find(".js-avatarY").val(b.cropY/this.scale)}});XF.Element.register("avatar-upload","XF.AvatarUpload");XF.Element.register("avatar-cropper","XF.AvatarCropper")}(jQuery,window,document);
