/*
 * XenForo code_editor.min.js
 * Copyright 2010-2017 XenForo Ltd.
 * Released under the XenForo License Agreement: https://xenforo.com/license-agreement
 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,f,d){b instanceof String&&(b=String(b));for(var g=b.length,a=0;a<g;a++){var c=b[a];if(f.call(d,c,a,b))return{i:a,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,f,d){b!=Array.prototype&&b!=Object.prototype&&(b[f]=d.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,f,d,g){if(f){d=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var a=b[g];a in d||(d[a]={});d=d[a]}b=b[b.length-1];g=d[b];f=f(g);f!=g&&null!=f&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,d){return $jscomp.findInternal(this,b,d).v}},"es6","es3");
!function(b,f,d,g){XF.CodeEditor=XF.Element.newHandler({options:{indentUnit:4,indentWithTabs:!0,lineNumbers:!0,lineWrapping:!1,autoCloseBrackets:!0,mode:null,config:null,submitSelector:null,scrollbarStyle:"simple"},editor:null,$wrapper:null,init:function(){if(this.$target[0].parentNode.scrollHeight)this.initEditor();else this.$target.oneWithin("toggle:shown overlay:showing tab:shown",b.proxy(this,"initEditor"))},initEditor:function(){var a=this.$target,c={};if(!a.data("cmInitialized")){try{c=b.parseJSON(this.options.config)}catch(e){c=
this.options.config}this.editor=CodeMirror.fromTextArea(a.get(0),b.extend({indentUnit:this.options.indentUnit,indentWithTabs:this.options.indentWithTabs,lineNumbers:this.options.lineNumbers,lineWrapping:this.options.lineWrapping,autoCloseBrackets:this.options.autoCloseBrackets,readOnly:a.prop("readonly"),autofocus:a.prop("autofocus"),scrollbarStyle:this.options.scrollbarStyle},c));this.$wrapper=b(this.editor.getWrapperElement());this.$wrapper.addClass(a.attr("class")).attr("dir","ltr");a.attr("class",
"");this.editor.refresh();XF.layoutChange();this.editor.on("keydown",b.proxy(this,"keydown"));a.trigger("code-editor:init",this.editor);a.data("cmInitialized",!0)}},keydown:function(a,c){if(XF.isMac()&&c.metaKey&&c.ctrlKey&&70==c.which||!XF.isMac()&&122==c.which)c.preventDefault(),a.setOption("fullScreen",!a.getOption("fullScreen"));27==c.which&&(c.stopPropagation(),a.getOption("fullScreen")&&a.setOption("fullScreen",!1));if((83==c.which||13==c.which)&&(XF.isMac()?c.metaKey:c.ctrlKey)){c.preventDefault();
var e=b(a.getTextArea()).closest("form"),d=this;this.editor.save();setTimeout(function(){var a=d.options.submitSelector,b=e.find(a);a&&b.length?e.find(a).click():e.submit()},200)}}});XF.CodeEditorSwitcherContainer=XF.Element.newHandler({options:{switcher:".js-codeEditorSwitcher",templateSuffixMode:0},$switcher:null,editor:null,loading:!1,init:function(){this.$target.on("code-editor:init",b.proxy(this,"initEditor"))},initEditor:function(a,c){var e=this.$target.find(this.options.switcher);if(e.length){this.$switcher=
e;if(e.is("select, :radio"))e.on("change",b.proxy(this,"change"));else if(e.is("input:not(:checkbox :radio)"))e.on("blur",b.proxy(this,"blurInput")),setTimeout(function(){e.trigger("blur")},100);else{console.warn("Switcher only works for text inputs, radios and selects.");return}this.editor=c}else console.warn("Switcher container has no switcher: %o",this.$target)},change:function(a){a=this.$switcher.find(":selected").val();this.switchLanguage(a)},blurInput:function(a){a=this.$switcher.val();this.options.templateSuffixMode&&
(a=a.toLowerCase(),a=0<a.indexOf(".less")?"less":0<a.indexOf(".css")?"css":"html");this.switchLanguage(a)},switchLanguage:function(a){if(!this.loading){var c=this,e=this.editor,d=b(e.getTextArea());e.save();d.data("lang")!=a&&setTimeout(function(){var d="public"==b("html").data("app")?"index.php?misc/code-editor-mode-loader":"admin.php?templates/code-editor-mode-loader";XF.ajax("post",XF.canonicalizeUrl(d),{language:a},b.proxy(c,"handleAjax")).always(function(){c.loading=!1})},200)}},handleAjax:function(a){if(!a.errors&&
!a.exception){a.redirect&&XF.redirect(a.redirect);var c=this.editor,d=b(c.getTextArea());XF.setupHtmlInsert(a.html,function(e,f){e="";a.mime?e=a.mime:a.mode&&(e=a.mode);c.setOption("mode",e);d.data("lang",a.language);d.data("config",JSON.stringify(a.config));a.config&&b.each(a.config,function(a,b){c.setOption(a,b)})})}}});XF.Element.register("code-editor","XF.CodeEditor");XF.Element.register("code-editor-switcher-container","XF.CodeEditorSwitcherContainer")}(jQuery,window,document);
